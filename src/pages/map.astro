---
import MainLayout from "../layouts/MainLayout.astro";
import MapContainer from "../components/map/MapContainer.astro";
import MapControls from "../components/map/MapControls.astro";
import FilterPanel from "../components/map/FilterPanel.astro";
import { getAllPianos } from "../utils/dataService";
import type { Piano } from "../utils/dataService";

const pianoId = Astro.url.searchParams.get("pianoId");

let pianos: Piano[] = [];
let error: string | null = null;

try {
  pianos = await getAllPianos();
} catch (err) {
  console.error("Error fetching pianos:", err);
  error = err instanceof Error ? err.message : "Failed to load piano data";
}
---

<MainLayout>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">Piano Map</h1>
    <div class="relative bg-base-200 rounded-xl overflow-hidden shadow-lg">
      <MapContainer pianos={pianos} pianoId={pianoId} error={error} />
      <MapControls />
      <FilterPanel pianos={pianos} />
    </div>
  </div>
</MainLayout>
