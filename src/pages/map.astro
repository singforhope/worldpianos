---
import MainLayout from "../layouts/MainLayout.astro";
import MapContainer from "../components/map/MapContainer.astro";
import MapControls from "../components/map/MapControls.astro";
import FilterPanel from "../components/map/FilterPanel.astro";
import { getAllPianos } from "../utils/dataService";
import type { Piano } from "../utils/dataService";

const pianoId = Astro.url.searchParams.get("pianoId");

let pianos: Piano[] = [];
let error: string | null = null;

try {
  pianos = await getAllPianos();
} catch (err) {
  console.error("Error fetching pianos:", err);
  error = err instanceof Error ? err.message : "Failed to load piano data";
}
---

<MainLayout>
  <div class="relative">
    <MapContainer pianos={pianos} pianoId={pianoId} error={error} />
    <MapControls />
    <FilterPanel pianos={pianos} />
  </div>
</MainLayout>
